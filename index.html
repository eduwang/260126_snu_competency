<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë©´ì ‘ìœ„ì› êµìœ¡ í”„ë¡œê·¸ë¨</title>
  <link rel="stylesheet" href="src/common.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="node_modules/sweetalert2/dist/sweetalert2.min.css">
  <style>
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .user-section {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .user-info {
      color: white;
      font-weight: 500;
    }
    
    .login-btn, .logout-btn {
      padding: 0.625rem 1.25rem;
      background: white;
      color: var(--primary-color);
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9375rem;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .login-btn:hover, .logout-btn:hover {
      background: #f3f4f6;
      transform: translateY(-1px);
    }
    
    .nav-item {
      opacity: 0.5;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    
    .nav-item.visible {
      opacity: 1;
      pointer-events: auto;
    }
    
    .nav-item.admin-only {
      display: none;
    }
    
    .nav-item.admin-only.show {
      display: flex;
    }
    
    .qr-code-container {
      width: 100%;
      height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1.5rem;
      overflow: hidden;
      border-radius: 8px;
      background: #f9fafb;
    }
    
    .qr-code-image {
      width: 80%;
      height: 80%;
      object-fit: contain;
      transition: transform 0.3s ease;
      cursor: pointer;
    }
    
    .nav-item:hover .qr-code-image {
      transform: scale(1.05);
    }
    
    .qr-popup-image {
      max-width: 90vw;
      max-height: 90vh;
      width: auto;
      height: auto;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="header-content">
        <div class="header-text">
          <h1>SNU ì—­ëŸ‰í‰ê°€ ë©´ì ‘ìœ„ì› êµìœ¡</h1>
          <p class="subtitle">SNU ì—­ëŸ‰í‰ê°€ ë©´ì ‘ìœ„ì› êµìœ¡</p>
        </div>
        <div class="user-section">
          <span id="userInfo" class="user-info">ğŸ” ë¡œê·¸ì¸ í›„ ì´ìš©í•´ ì£¼ì„¸ìš”.</span>
          <button id="loginBtn" class="login-btn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
              <polyline points="10 17 15 12 10 7"></polyline>
              <line x1="15" y1="12" x2="3" y2="12"></line>
            </svg>
            ë¡œê·¸ì¸
          </button>
          <button id="logoutBtn" class="logout-btn" style="display: none;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            ë¡œê·¸ì•„ì›ƒ
          </button>
        </div>
      </div>
    </header>

    <main>
      <nav class="nav-menu">
        <!-- 1ì—´: ëª¨ì˜í‰ê°€ -->
        <div class="nav-column">
          <h3 class="column-title">ëª¨ì˜í‰ê°€</h3>
          <a href="01_mock_eval_04_health_inequality.html" class="nav-item" id="nav-mock-eval-04">
            <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <h2>ê±´ê°• ë¶ˆí‰ë“±</h2>
            <p></p>
          </a>
          <a href="01_mock_eval_06_traffic_accident.html" class="nav-item" id="nav-mock-eval-06">
            <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <h2>êµí†µì‚¬ê³  ë°°ìƒê¸ˆ ê³„ì‚°</h2>
            <p></p>
          </a>
          <a href="01_mock_eval_03_escape_plan.html" class="nav-item" id="nav-mock-eval-03">
            <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <h2>ëŒ€í”¼ ì‹œë®¬ë ˆì´ì…˜</h2>
            <p></p>
          </a>

          <a href="01_mock_eval_02_college_entrance.html" class="nav-item" id="nav-mock-eval-02">
            <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <h2>ëŒ€í•™ ì…ì‹œ ì•Œê³ ë¦¬ì¦˜</h2>
            <p></p>
          </a>



          <a href="01_mock_eval_01_bottle_crack.html" class="nav-item" id="nav-mock-eval-01">
            <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <h2>ìœ ë¦¬ë³‘ ê· ì—´ íŒ¨í„´</h2>
            <p></p>
          </a>

          <a href="01_mock_eval_05_AI_ethics.html" class="nav-item" id="nav-mock-eval-05">
            <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <h2>ì¸ê³µì§€ëŠ¥ ìœ¤ë¦¬</h2>
            <p></p>
          </a>
        </div>

        <!-- 2ì—´: íƒì¹¨ ì§ˆë¬¸ ë§Œë“¤ê¸° + ë‹¤ë¥¸ ì‚¬ëŒ ê²°ê³¼ ë³´ê¸° -->
        <div class="nav-column">
          <h3 class="column-title">íƒì¹¨ ì§ˆë¬¸ ë§Œë“¤ê¸°</h3>
          <a href="02_probing_question_02_health_inequality.html" class="nav-item" id="nav-probing-02">
            <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
              <line x1="9" y1="10" x2="15" y2="10"></line>
              <line x1="9" y1="14" x2="15" y2="14"></line>
            </svg>
            <h2>ê±´ê°• ë¶ˆí‰ë“± ì—°êµ¬</h2>
            <p></p>
          </a>
          <a href="02_probing_question_01_escape_plan.html" class="nav-item" id="nav-probing-01">
            <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
              <line x1="9" y1="10" x2="15" y2="10"></line>
              <line x1="9" y1="14" x2="15" y2="14"></line>
            </svg>
            <h2>ëŒ€í”¼ ì‹œë®¬ë ˆì´ì…˜</h2>
            <p></p>
          </a>
          <a href="02_probing_question_03_AI_ethics.html" class="nav-item" id="nav-probing-03">
            <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
              <line x1="9" y1="10" x2="15" y2="10"></line>
              <line x1="9" y1="14" x2="15" y2="14"></line>
            </svg>
            <h2>ì¸ê³µì§€ëŠ¥ ìœ¤ë¦¬</h2>
            <p></p>
          </a>

          <a href="results.html" class="nav-item" id="nav-results">
            <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="8" y1="6" x2="21" y2="6"></line>
              <line x1="8" y1="12" x2="21" y2="12"></line>
              <line x1="8" y1="18" x2="21" y2="18"></line>
              <line x1="3" y1="6" x2="3.01" y2="6"></line>
              <line x1="3" y1="12" x2="3.01" y2="12"></line>
              <line x1="3" y1="18" x2="3.01" y2="18"></line>
            </svg>
            <h2>ë‹¤ë¥¸ ì‚¬ëŒ ê²°ê³¼ ë³´ê¸°</h2>
            <p>ë‹¤ë¥¸ ì°¸ê°€ìë“¤ì´ ì œì‘í•œ íƒì¹¨ì§ˆë¬¸ê³¼ ê²°ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
          </a>
        </div>

        <!-- 3ì—´: ë§Œì¡±ë„ ì¡°ì‚¬ + ê´€ë¦¬ì í˜ì´ì§€ -->
        <div class="nav-column">
          <h3 class="column-title">ê¸°íƒ€</h3>
          <div class="nav-item visible" id="nav-qr-code">
            <div class="qr-code-container">
              <img src="link_qr.png" alt="QR ì½”ë“œ" class="qr-code-image" id="qr-code-image">
            </div>
            <h2 class="qr-link-text" style="cursor: pointer;">ì›Œí¬ìˆ ë§Œì¡±ë„ ì¡°ì‚¬</h2>
            <p class="qr-link-text" style="cursor: pointer;">Link</p>
          </div>

          <a href="admin.html" class="nav-item admin-only" id="nav-admin">
            <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
            <h2>ê´€ë¦¬ì í˜ì´ì§€</h2>
            <p>ëª¨ë“  ë°ì´í„°ë¥¼ í™•ì¸í•˜ê³  ì‚¬ìš©ìë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.</p>
          </a>
        </div>
      </nav>
    </main>

    <footer class="footer">
      <p>&copy; 2026 SNU ì—­ëŸ‰í‰ê°€ ë©´ì ‘ìœ„ì› êµìœ¡ í”„ë¡œê·¸ë¨</p>
    </footer>
  </div>

  <script type="module">
    import { auth, db, isAdmin } from './src/firebaseConfig.js';
    import { signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'firebase/auth';
    import { doc, getDoc, query, where, getDocs, collection } from 'firebase/firestore';
    import Swal from 'sweetalert2';

    // DOM ìš”ì†Œ
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const userInfo = document.getElementById('userInfo');
    const navItems = {
      mockEval01: document.getElementById('nav-mock-eval-01'),
      mockEval02: document.getElementById('nav-mock-eval-02'),
      mockEval03: document.getElementById('nav-mock-eval-03'),
      mockEval04: document.getElementById('nav-mock-eval-04'),
      mockEval05: document.getElementById('nav-mock-eval-05'),
      mockEval06: document.getElementById('nav-mock-eval-06'),
      probing01: document.getElementById('nav-probing-01'),
      probing02: document.getElementById('nav-probing-02'),
      probing03: document.getElementById('nav-probing-03'),
      results: document.getElementById('nav-results'),
      admin: document.getElementById('nav-admin')
    };
    
    const qrCodeItem = document.getElementById('nav-qr-code');
    
    // QR ì½”ë“œ í•­ëª©ì€ í•­ìƒ í™œì„±í™”
    if (qrCodeItem) {
      qrCodeItem.classList.add('visible');
    }

    // ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    loginBtn.addEventListener('click', async () => {
      console.log('ğŸ” ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­ë¨');
      
      const result = await Swal.fire({
        title: 'ë¡œê·¸ì¸',
        html: `
          <input id="swal-email" class="swal2-input" placeholder="ì´ë©”ì¼ (ì•„ì´ë””)" type="email" required>
          <input id="swal-password" class="swal2-input" placeholder="ë¹„ë°€ë²ˆí˜¸" type="password" required>
        `,
        showCancelButton: true,
        confirmButtonText: 'ë¡œê·¸ì¸',
        cancelButtonText: 'ì·¨ì†Œ',
        allowOutsideClick: false,
        preConfirm: () => {
          let email = document.getElementById('swal-email').value.trim();
          const password = document.getElementById('swal-password').value;
          
          if (!email || !password) {
            Swal.showValidationMessage('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return false;
          }
          
          // 'admin'ë§Œ ì…ë ¥í•œ ê²½ìš° 'admin@local.local'ë¡œ ë³€í™˜
          if (email.toLowerCase() === 'admin') {
            email = 'admin@local.local';
          }
          
          return { email, password };
        }
      });

      if (result.isConfirmed) {
        try {
          Swal.fire({
            title: 'ë¡œê·¸ì¸ ì¤‘...',
            allowOutsideClick: false,
            allowEscapeKey: false,
            didOpen: () => {
              Swal.showLoading();
            }
          });

          const { email, password } = result.value;
          const userCredential = await signInWithEmailAndPassword(auth, email, password);
          console.log('âœ… ë¡œê·¸ì¸ ì„±ê³µ:', userCredential.user.email);
          
          Swal.close();
          
        } catch (error) {
          console.error('âŒ ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
          
          let errorMessage = 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
          
          if (error.code === 'auth/user-not-found') {
            errorMessage = 'ë“±ë¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤.';
          } else if (error.code === 'auth/wrong-password') {
            errorMessage = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
          } else if (error.code === 'auth/invalid-email') {
            errorMessage = 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.';
          } else if (error.message) {
            errorMessage = error.message;
          }
          
          Swal.fire({
            icon: 'error',
            title: 'ë¡œê·¸ì¸ ì‹¤íŒ¨',
            text: errorMessage,
            confirmButtonText: 'í™•ì¸'
          });
        }
      }
    });

    // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    logoutBtn.addEventListener('click', async () => {
      const result = await Swal.fire({
        title: 'ë¡œê·¸ì•„ì›ƒ',
        text: 'ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'ë¡œê·¸ì•„ì›ƒ',
        cancelButtonText: 'ì·¨ì†Œ',
        confirmButtonColor: '#ef4444'
      });

      if (result.isConfirmed) {
        try {
          await signOut(auth);
          Swal.fire({
            icon: 'success',
            title: 'ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ',
            text: 'ì„±ê³µì ìœ¼ë¡œ ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.',
            timer: 1500,
            showConfirmButton: false
          });
        } catch (error) {
          console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
          Swal.fire({
            icon: 'error',
            title: 'ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨',
            text: 'ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
            confirmButtonText: 'í™•ì¸'
          });
        }
      }
    });

    // ë©”ë‰´ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ë° ì ìš©
    async function loadMenuSettings() {
      try {
        const settingsDoc = await getDoc(doc(db, 'menuSettings', 'main'));
        const settings = settingsDoc.exists() ? settingsDoc.data() : {};
        
        // ê° ë²„íŠ¼ì˜ í‘œì‹œ ì—¬ë¶€ ì„¤ì •
        if (navItems.mockEval01) {
          navItems.mockEval01.style.display = (settings.mockEval01 !== false) ? 'flex' : 'none';
        }
        if (navItems.mockEval02) {
          navItems.mockEval02.style.display = (settings.mockEval02 !== false) ? 'flex' : 'none';
        }
        if (navItems.mockEval03) {
          navItems.mockEval03.style.display = (settings.mockEval03 !== false) ? 'flex' : 'none';
        }
        if (navItems.mockEval04) {
          navItems.mockEval04.style.display = (settings.mockEval04 !== false) ? 'flex' : 'none';
        }
        if (navItems.mockEval05) {
          navItems.mockEval05.style.display = (settings.mockEval05 !== false) ? 'flex' : 'none';
        }
        if (navItems.mockEval06) {
          navItems.mockEval06.style.display = (settings.mockEval06 !== false) ? 'flex' : 'none';
        }
        if (navItems.probing01) {
          navItems.probing01.style.display = (settings.probing01 !== false) ? 'flex' : 'none';
        }
        if (navItems.probing02) {
          navItems.probing02.style.display = (settings.probing02 !== false) ? 'flex' : 'none';
        }
        if (navItems.probing03) {
          navItems.probing03.style.display = (settings.probing03 !== false) ? 'flex' : 'none';
        }
        if (navItems.results) {
          navItems.results.style.display = (settings.activity2 !== false) ? 'flex' : 'none';
        }
        if (qrCodeItem) {
          qrCodeItem.style.display = (settings.qrCode !== false) ? 'flex' : 'none';
        }
      } catch (error) {
        console.error('ë©”ë‰´ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', error);
      }
    }

    // ë„¤ë¹„ê²Œì´ì…˜ í•­ëª© í´ë¦­ ì´ë²¤íŠ¸ (ë¡œê·¸ì¸ ì²´í¬)
    Object.values(navItems).forEach(navItem => {
      if (navItem && navItem !== navItems.admin) {
        navItem.addEventListener('click', (e) => {
          if (!auth.currentUser) {
            e.preventDefault();
            Swal.fire({
              icon: 'warning',
              title: 'ë¡œê·¸ì¸ í•„ìš”',
              text: 'ì´ í˜ì´ì§€ë¥¼ ì´ìš©í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.',
              confirmButtonText: 'í™•ì¸'
            });
          }
        });
      }
    });
    
    // QR ì½”ë“œ ì´ë¯¸ì§€ í´ë¦­ ì´ë²¤íŠ¸ - ì´ë¯¸ì§€ í™•ëŒ€ íŒì—…
    const qrCodeImage = document.getElementById('qr-code-image');
    if (qrCodeImage) {
      qrCodeImage.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        Swal.fire({
          html: `<img src="link_qr.png" alt="QR ì½”ë“œ" class="qr-popup-image">`,
          width: 'auto',
          padding: '2rem',
          showConfirmButton: true,
          confirmButtonText: 'ë‹«ê¸°',
          customClass: {
            popup: 'qr-popup',
            htmlContainer: 'qr-popup-container'
          },
          didOpen: () => {
            const popup = document.querySelector('.qr-popup');
            if (popup) {
              popup.style.textAlign = 'center';
            }
          }
        });
      });
    }
    
    // í…ìŠ¤íŠ¸ í´ë¦­ ì´ë²¤íŠ¸ - Google Forms ë§í¬ë¡œ ì´ë™
    const qrLinkTexts = document.querySelectorAll('.qr-link-text');
    qrLinkTexts.forEach(textElement => {
      textElement.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        window.open('https://docs.google.com/forms/d/e/1FAIpQLSdDQxJBWnsGv_pkY3zqeFwGaBCApsTQkNrIl0PFyL3Y-0YPsA/viewform', '_blank');
      });
    });

    // ì¸ì¦ ìƒíƒœ ë³€ê²½ ê°ì§€
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        // ë¡œê·¸ì¸ëœ ì‚¬ìš©ì - UI ì—…ë°ì´íŠ¸
        await updateUserUI(user);
      } else {
        // ë¡œê·¸ì•„ì›ƒëœ ê²½ìš°
        userInfo.textContent = 'ğŸ” ë¡œê·¸ì¸ í›„ ì´ìš©í•´ ì£¼ì„¸ìš”.';
        loginBtn.style.display = 'flex';
        logoutBtn.style.display = 'none';

        // ëª¨ë“  ë„¤ë¹„ê²Œì´ì…˜ í•­ëª© ë¹„í™œì„±í™” (QR ì½”ë“œ ì œì™¸)
        Object.values(navItems).forEach(navItem => {
          if (navItem) {
            navItem.classList.remove('visible');
          }
        });
        
        // QR ì½”ë“œ í•­ëª©ì€ í•­ìƒ í™œì„±í™” ìœ ì§€
        if (qrCodeItem) {
          qrCodeItem.classList.add('visible');
        }

        // ê´€ë¦¬ì ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        navItems.admin.classList.remove('show');
        
        sessionStorage.removeItem('justLoggedIn');
      }
    });
    
    // ì‚¬ìš©ì UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    async function updateUserUI(user) {
      // ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      try {
        const userQuery = query(collection(db, 'users_new'), where('uid', '==', user.uid));
        const userSnapshot = await getDocs(userQuery);
        
        let displayName = user.displayName || user.email;
        if (!userSnapshot.empty) {
          const userData = userSnapshot.docs[0].data();
          if (userData.name) {
            displayName = `${userData.name}${userData.affiliation ? ` (${userData.affiliation})` : ''}`;
          }
        }
        
        userInfo.textContent = `ğŸ‘¤ ${displayName} ë‹˜`;
      } catch (error) {
        console.error('ì‚¬ìš©ì ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', error);
        userInfo.textContent = `ğŸ‘¤ ${user.displayName || user.email} ë‹˜`;
      }
      
      loginBtn.style.display = 'none';
      logoutBtn.style.display = 'flex';

      // ëª¨ë“  ë„¤ë¹„ê²Œì´ì…˜ í•­ëª© í™œì„±í™”
      Object.values(navItems).forEach(navItem => {
        if (navItem) {
          navItem.classList.add('visible');
        }
      });

      // ë©”ë‰´ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ë° ì ìš©
      await loadMenuSettings();

      // ê´€ë¦¬ì ì—¬ë¶€ í™•ì¸
      const userIsAdmin = await isAdmin(user);
      if (userIsAdmin) {
        navItems.admin.classList.add('show');
      } else {
        navItems.admin.classList.remove('show');
      }

      // ë¡œê·¸ì¸ ì„±ê³µ ì•Œë¦¼ (ì²˜ìŒ ë¡œê·¸ì¸í•œ ê²½ìš°ì—ë§Œ)
      if (sessionStorage.getItem('justLoggedIn') !== 'true') {
        sessionStorage.setItem('justLoggedIn', 'true');
        // ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ì–´ ë¡œë”©ì´ ì™„ì „íˆ ë‹«íŒ í›„ í‘œì‹œ
        setTimeout(() => {
          Swal.fire({
            icon: 'success',
            title: 'ë¡œê·¸ì¸ ì„±ê³µ',
            text: `${user.displayName || user.email}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!`,
            timer: 2000,
            showConfirmButton: false
          });
        }, 300);
      }
    }
  </script>
</body>
</html>
